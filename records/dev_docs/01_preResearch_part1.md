# 2023.04.01-2023.04.10 worklog
## 工作进展
本阶段主要进行项目的前期准备工作，通过查阅资料了解稀疏矩阵向量乘的计算过程，并查阅文献了解相关现有优化技术。
## 资料收集
### 稀疏矩阵数据格式
https://zhuanlan.zhihu.com/p/342942385
CSR包含三个数组（所有的index从0开始）：

values，用来存储矩阵中的非零元素的值；
col_index，第i个元素记录了values[i]元素的列索引；
row_ptr, 第i个元素记录了前i-1行包含的非零元素的数量

### SpMV计算过程
参考链接：https://blog.csdn.net/m0_74478846/article/details/129045041

稀疏矩阵向量乘（SpMV）把一个稀疏矩阵与一个向量相乘。稀疏矩阵是指矩阵中大部分元素为0的矩阵。这里的向量本身也可是稀疏的，但通常情况下是密集的。

作为一种通用的运算，在科学应用、经济模型、数据挖掘、信息检索中广泛应用。例如，在利用迭代法求解稀疏线性方程组和特征值的问题。同时，也被应用于网页搜索排名和计算机视觉（图像重构等）。

## 龙芯架构学习
当想充分利用龙芯架构实现函数时，我们不断查阅手册。为了方便队友查看自己写的汇编函数，我们每次用到一个新的指令就把汇编指令记录在一个共享文档里。内容样式如下。
| 指令名称             | 类型   | 说明                                                         |
|----------------------|--------|---------------------------------------------------------------|
| srli.d $rd, $rj, ui6  | 移位   | 将通用寄存器rj中[63:0]位数据逻辑右移{ui6}位，移位结果写入通用寄存器rd中 |
| fld.d $fd, $rj, si12  | 访存   | 从内存（$rj + 12位符号扩展立即数）取回一个8B的数据写入浮点寄存器fd。 |
| sll.d $rd, $rj, rk    | 移位   | 将通用寄存器rj中[63:0]位数据逻辑左移{rk}，移位结果写入通用寄存器rd中。 |
| xvhaddw.q.d $xd, $xj, $xk | 运算 | 将向量寄存器xj中每个奇数位的8B元素与xk中对应的偶数位的元素做有符号整数加，所得结果符号扩展至两倍宽写入向量寄存器xd |
| xvpickve.d xd, xj, ui2 | 运算   | 将向量寄存器xj中的{ui2}个8B元素写入到xd的第0个元素中，其余部分置0 |
| movfr2gr.d rd, fj    | 访存   | 将浮点寄存器fj的64位值写入通用寄存器rd                      |
| xvinsgr2vr.d xd, rj, ui2 | 运算 | 将通用寄存器rj的8B数据写入到向量寄存器xd中由立即数{ui2}索引的8B元素中，其他元素值不变。 |
| xvpickve2gr.du rd, xj, ui2 | 运算 | 将向量寄存器xj中由立即数{ui2}索引的无符号整数双字元素零扩展后写入到通用寄存器rj中 |
| xvinsve0.d xd, xj, ui2 | 运算 | 将向量寄存器xj中的第0个8B元素写入到向量寄存器xd中第{ui2}个双字元素中，xd其余内容不变 |
| xvldrepl.d vd, rj, si9 | 访存 | 从内存中取回一个双字的数据广播到vd/xd的每一个双字（8Byte）元素中 |
| xvldrepl.w vd, rj, si10 | 访存 | 从内存中取回一个双字的数据广播到vd/xd的每一个双字（8Byte）元素中 |
| vslli.w vd, vj, ui5 | 移位   | 对向量寄存器vj中各个字元素进行逻辑左移，左移位数由立即数ui5指定，结果保存在vd中 |
| xvilvl.d xd, xj, xk  | 运算   | 将xk中每128位中低半部分的双字元素与xj中对应位置的双字元素交替写入xd中 |
| xvpermi.d xd, xj, ui8 | 运算 | 将ui8[1:0],[3:2],[5:4],[7:6]值作为索引值，从xj中取出一个双字元素(64位)依次写入xd中，对xj中的4个double数重新的排列组合 |
| xvpermi.q xd, xj, ui8 | 运算 | 将ui8[3:0],[7:4]值作为索引值，从xj中取出一个4字元素(128位)依次写入xd中，对xj中的2个128位数重新的排列组合 |
| xvbsrl.v xd, xj, ui5 | 移位   | 将xj中每128位数据右移ui5个字节，高位补零，结果存放到xd中   |
| xvpackod.d xd, xj, xk | 运算 | 将xj中每个奇数位置的双字元素与xk中的对应位置双字元素打包在一起，两两一组写入xd中 |
| xvpackev.d xd, xj, xk | 运算 | 将xj中每个偶数位置的双字元素与xk中的对应位置双字元素打包在一起，两两一组写入xd中 |
| xvmul.d xd, xj, xk  | 运算   | 将xj中的各个双字元素分别乘以xk中对应的双字元素，将乘积的低半部分写入xd中，之后保存结果的[63:0]位 |
| fldx.d rj, rk        | 访存   | 从内存取回一个双字的数据写入浮点寄存器fd，地址计算方式为rj + rk  |


## 板卡资源申请

在龙芯技术交流群中联系相关老师获得3C5000远程登录的ip，为后续开发做准备

